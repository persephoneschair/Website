<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Controller</title>
  <link rel="icon" href="../Images/Icon.png" type="image/png">
  <style>
        .menu-icon {
          position: fixed;
          bottom: 0.5rem;
          left: 1.2rem;
          z-index: 1002;
          background: rgba(21,42,90,0.85);
          border: 2px solid #2563eb;
          border-radius: 50%;
          width: 3.2rem;
          height: 3.2rem;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: background 0.15s, border-color 0.15s;
          box-shadow: 0 2px 8px #000a;
        }
        .menu-icon:hover, .menu-icon:focus {
          background: #0b3797;
          border-color: #f3ec40;
        }
        .menu-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(10,10,10,0.7);
          z-index: 1001;
          display: none;
          align-items: flex-end;
          justify-content: flex-start;
          animation: fadeIn 0.2s;
        }
        .menu-overlay.active {
          display: flex;
        }
        .menu-content {
          background: #152a5a;
          border-radius: 20px 20px 20px 20px;
          box-shadow: 0 4px 24px #000a;
          /* remove left padding so the home button can sit flush with the page edge */
          padding: 1.2rem 1.5rem 1.2rem 0;
          margin-bottom: 2.5rem;
          min-width: 0;
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          margin-left: 0;
        }
        .menu-home-btn {
          margin-bottom: 0;
        }
        .menu-home-btn {
          background: #152a5a;
          color: #fff;
          border: 2px solid #2563eb;
          border-radius: 12px;
          padding: 1.2rem 2.5rem;
          font-size: 1.5rem;
          font-family: 'Segoe UI', sans-serif;
          font-weight: 700;
          text-align: center;
          text-decoration: none;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
          transition: all 0.15s ease;
          margin-bottom: 1rem;
          margin-left: 0; /* ensure flush alignment */
          cursor: pointer;
          display: block;
        }
        .menu-home-btn:hover, .menu-home-btn:focus {
          box-shadow: 0 0 25px rgba(243, 236, 64, 1);
          border-color: #f3ec40;
          background: #0b3797;
          color: #fff;
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
    /* Use viewport sizing but avoid fixed 100vh which can be obscured by mobile browser UI.
       Reserve a small bottom bar (menu area) so the embedded iframe never gets
       obscured by browser chrome; the menu icon sits inside that bar. */
    :root {
      /* base bottom buffer (used on desktop if JS adjusts it) */
      --bottom-bar-height: calc(env(safe-area-inset-bottom, 0px) + 70px);
      --menu-icon-size: 3.2rem;
    }

    /* Mobile-only: make the bottom bar exactly the height of the home/menu
       button so the iframe never extends into that space. Give the bar a
       visible hotpink background for testing. */
    @media (max-width: 899px) {
      /* Make the bottom bar exactly the visual size of the icon plus a
         small buffer to account for borders/shadow. Use !important so later
         rules in the file don't accidentally override the mobile intent. */
      :root { --menu-icon-size: 3.0rem; --bottom-bar-height: calc(var(--menu-icon-size) + 8px); }
      .bottom-bar { background: hotpink !important; align-items: center !important; padding-left: 0 !important; height: var(--bottom-bar-height) !important; }
      /* Ensure the menu icon sits flush, uses box-sizing so border is included
         inside its declared size, and remove any margin/position offsets. */
      .menu-icon { margin: 0 !important; box-sizing: border-box !important; position: relative !important; left: 0 !important; bottom: 0 !important; width: var(--menu-icon-size) !important; height: var(--menu-icon-size) !important; }
      /* Make the svg smaller inside the nub so stroke/padding fit comfortably. */
      .menu-icon svg { width: 60% !important; height: 60% !important; }
    }
    html, body {
      background: #0a0a0a;
      margin: 0;
      padding: 0;
      width: 100%;
      min-height: 100%;
      -webkit-text-size-adjust: 100%;
      box-sizing: border-box;
      /* allow scrolling so mobile browser UI doesn't permanently hide content */
      overflow: auto;
      /* ensure content doesn't get hidden under the bottom bar */
      padding-bottom: var(--bottom-bar-height);
    }

    /* bottom bar that sits above the iframe and holds controls (menu/home) */
    .bottom-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: var(--bottom-bar-height);
      /* Force visible background during debugging - remove !important when confirmed */
      background: hotpink !important;
      z-index: 1000;
      display: flex;
      align-items: center;
      padding-left: 1.2rem;
      box-sizing: border-box;
      pointer-events: auto;
    }

    .menu-icon {
      position: relative;
      z-index: 1002;
      background: rgba(21,42,90,0.95);
      border: 2px solid #2563eb;
      border-radius: 50%;
      width: var(--menu-icon-size);
      height: var(--menu-icon-size);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
      box-shadow: 0 2px 8px #000a;
    }

    .menu-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(10,10,10,0.7);
          z-index: 1001;
          display: none;
          align-items: flex-end;
          justify-content: flex-start;
          animation: fadeIn 0.2s;
        }

    .menu-content {
          background: #152a5a;
          border-radius: 20px 20px 20px 20px;
          box-shadow: 0 4px 24px #000a;
          padding: 1.2rem 1.5rem;
          /* lift the overlay content above the bottom bar */
          margin-bottom: calc(var(--bottom-bar-height) + 0.5rem);
          min-width: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-left: 0;
        }

    /* Fullscreen iframe but leave the reserved bottom bar so home/menu sits below it */
    .fullscreen-iframe {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: calc(100vh - var(--bottom-bar-height));
      border: none;
      margin: 0;
      padding: 0;
      z-index: 1;
      background: #000;
      display: block;
      box-sizing: border-box;
    }

    /* Desktop: remove the bottom bar buffer and position the menu icon fixed in the corner */
    @media (min-width: 900px) {
      :root { --bottom-bar-height: 0px; }
      .bottom-bar { height: 0; background: transparent; padding-left: 0; }
      html, body { padding-bottom: 0; }
      .fullscreen-iframe { height: 100vh; }
      .menu-icon { position: fixed; bottom: 0.5rem; left: 1.2rem; }
      .menu-content { margin-bottom: 0.5rem; align-items: center; }
    }
  </style>
</head>
<body>
    <div class="bottom-bar">
      <div class="menu-icon" id="menuIcon" tabindex="0" title="Open menu" aria-label="Open menu">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#f3ec40" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:block;">
          <path d="M3 11.5L12 5l9 6.5"/>
          <path d="M5 10.5V19a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1V19a1 1 0 0 0 1 1H18a1 1 0 0 0 1-1v-8.5"/>
        </svg>
      </div>
    </div>
    <div class="menu-overlay" id="menuOverlay">
      <div class="menu-content">
        <a href="../index.html" class="menu-home-btn">Home</a>
      </div>
    </div>
  <iframe
    src="https://itch.io/embed-upload/15658305?color=000000"
    title="Universal Controller"
    class="fullscreen-iframe"
    allowfullscreen
    loading="lazy"
  ></iframe>
</body>
  <script>
    const menuIcon = document.getElementById('menuIcon');
    const menuOverlay = document.getElementById('menuOverlay');
    // Open overlay
    function openMenu() {
      menuOverlay.classList.add('active');
    }
    // Close overlay
    function closeMenu(e) {
      if (e.target === menuOverlay) {
        menuOverlay.classList.remove('active');
      }
    }
    menuIcon.addEventListener('click', openMenu);
    menuIcon.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' || e.key === ' ') openMenu();
    });
    menuOverlay.addEventListener('click', closeMenu);
    // Optional: ESC to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') menuOverlay.classList.remove('active');
    });
    // Ensure bottom-bar buffer accounts for mobile browser chrome which can
    // change the visual viewport (address bar, toolbars). We compute an extra
    // offset from the difference between window.innerHeight and visualViewport.height
    // and update the CSS variable `--bottom-bar-height` accordingly. This runs
    // on load, resize and visualViewport changes so the iframe stays above UI.
    function updateBottomBar() {
      try {
        // If we're on a narrow/mobile viewport, prefer the fixed CSS buffer and
        // don't override it from JS (some mobile browsers handle 100vh differently).
        if (window.matchMedia && window.matchMedia('(max-width: 899px)').matches) return;
        const base = 56; // same base buffer used in CSS
        const innerH = window.innerHeight || 0;
        const vvH = (window.visualViewport && window.visualViewport.height) || innerH;
        const extra = Math.max(0, innerH - vvH);
        const value = Math.round(base + extra + (window.CSS && CSS.supports && CSS.supports('top: env(safe-area-inset-bottom)') ? 0 : 0));
        document.documentElement.style.setProperty('--bottom-bar-height', value + 'px');
      } catch (e) {
        // fail silently
      }
    }
    updateBottomBar();
    window.addEventListener('resize', updateBottomBar);
    if (window.visualViewport) window.visualViewport.addEventListener('resize', updateBottomBar);
  </script>
</html>
