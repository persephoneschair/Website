<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="../Images/Icon.png" type="image/png">
  <meta charset="UTF-8" />
  <title>GAME NIGHT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
 <style>
                .home-btn-wrapper {
                  display: flex;
                  align-items: flex-start;
                }
                @media (max-width: 600px) {
                  .home-btn-wrapper {
                    justify-content: center;
                  }
                  .home-btn {
                    margin-left: 0;
                    margin-right: 0;
                  }
                }
            @media (max-width: 600px) {
              .home-btn {
                display: block;
                margin: 2rem auto 0 auto;
                text-align: center;
              }
            }
        .home-btn {
          display: inline-block;
          margin: 0.5rem 0 0 0;
          background: #152a5a;
          color: #fff;
          border: 2px solid #2563eb;
          border-radius: 12px;
          padding: 1.2rem 2.5rem;
          font-size: 1.5rem;
          font-family: 'Segoe UI', sans-serif;
          font-weight: 700;
          text-align: center;
          text-decoration: none;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
          transition: all 0.15s ease;
          position: relative;
          overflow: hidden;
          cursor: pointer;
        }
        .home-btn:hover, .home-btn:focus {
          box-shadow: 0 0 25px rgba(243, 236, 64, 1);
          transform: scale(1.05);
          border-color: #f3ec40;
          background: #0b3797;
          color: #fff;
        }
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    @font-face {
      font-family: 'Game Over';
      src: url('../Fonts/Game Over.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-size: 40rem
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #000000;
      padding: 2rem;
      color: #e0e7ff;
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 12px;
    }
    
    ::-webkit-scrollbar-track {
      background: #000000;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #2563eb, #0b3797);
      border-radius: 6px;
      border: 2px solid #000000;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #0b3797, #2563eb);
    }
    
    /* Firefox scrollbar */
    * {
      scrollbar-width: thin;
      scrollbar-color: #2563eb #000000;
    }

    #mainContent {
      opacity: 0;
      visibility: hidden;
      transition: opacity 1.5s ease-in, visibility 0s;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #f3ec40;
      text-transform: uppercase;
      font-size: 12rem;
      font-family: 'Game Over', sans-serif;
      letter-spacing: 0.1em;
      text-shadow: 
        -2px -2px 0 #1e3a8a,
        2px -2px 0 #1e3a8a,
        -2px 2px 0 #1e3a8a,
        2px 2px 0 #1e3a8a,
        -2px 0 0 #1e3a8a,
        2px 0 0 #1e3a8a,
        0 -2px 0 #1e3a8a,
        0 2px 0 #1e3a8a;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    select, label.checkbox {
      padding: 0.75rem 1.25rem;
      font-size: 1.1rem;
      font-family: 'Segoe UI', sans-serif;
      border-radius: 12px;
      border: 2px solid #2563eb;
      background-color: #1e3a8a;
      color: #d1d9ff;
      cursor: pointer;
      transition: border-color 0.15s ease;
    }

    select:hover, label.checkbox:hover {
      border-color: #f3ec40;
    }

    label.checkbox {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background-color: #1e3a8a;
      border-radius: 12px;
      border: 2px solid #2563eb;
      padding: 0.65rem 1.1rem;
    }

    input[type="checkbox"] {
      accent-color: #f3ec40;
      transform: scale(1.2);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      max-width: 3840px;
      margin: 0 auto;
    }

    .card {
      background: #152a5a;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      padding: 1rem;
      text-align: center;
      color: #d1d9ff;
      cursor: pointer;
      border: 2px solid #2563eb;
      transition: all 0.15s ease;
    }
    
    .card:hover {
      box-shadow: 0 0 25px rgba(243, 236, 64, 1);
      transform: scale(1.05);
      border-color: #f3ec40;
      border-radius: 25px;
      background: #0b3797;
      border-width: 4px;
    }

    .card iframe {
      width: 100%;
      height: 275px;
      border-radius: 8px;
      border: none;
      background: #000;
    }

    .meta {
      margin-top: 1rem;
    }

    .meta h2 {
    max-height: 6.5em;
    overflow-y: auto;
      margin: 0.5rem 0 0.2rem;
      color: #f3ec40;
      margin-bottom: 0.5rem;
      margin-top: 0.5rem;
      font-size: 1.5rem;
    }

    .meta p {
      margin: 0.2rem;
      color: #a8b2d1;
      font-size: 1.1rem;
      font-style: italic;
     max-height: 8em;
    overflow-y: auto;
      
    }
    
    .meta ep {
      margin: 0.2rem;
      color: #a8b2d1;
      font-size: 1.25rem;
    }

    .meta ep-title {
      margin: 0;
      color: #d1d9ff;
      font-size: 1.5rem;
      display: block;
      text-align: center;
    }

    .meta ep-author {
      margin: 0.2rem 0 0.5rem 0;
      color: #f3ec40;
      font-size: 1rem;
      display: block;
      text-align: center;
    }

    .section-episode {
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: none;
    }

    .section-title {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .section-formats {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .section-details {
      margin-top: 0;
      border-top: none;
    }

    .section-details:not(:empty) {
      margin-top: 0.5rem;
    }

    .hidden {
      display: none !important;
    }
    
    #clearFiltersBtn {
  background-color: firebrick;
  color: #fff;
  border: none;
  padding: 0.5rem 1.2rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
}
#clearFiltersBtn:hover {
  background-color: #b22222;
}
.thumb-wrapper {
  position: relative;
  display: block;
  border-radius: 1rem;
  overflow: hidden;
}

.thumbnail-img {
  width: 100%;
  display: block;
  border-radius: 1rem;
}

.play-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-55%, -45%);
  pointer-events: none;
  opacity: 0.9;
  filter: drop-shadow(0 0 6px black);
}

#loadingScreen {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #000000;
  color: #f3ec40;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 8vw;
  z-index: 1000;
  font-family: 'Game Over', sans-serif;
  letter-spacing: 0.05em;
  text-shadow: 0 0 20px rgba(243, 236, 64, 0.8), 0 0 40px rgba(243, 236, 64, 0.5);
  animation: pulse 1s ease-in-out infinite;
  visibility: visible;
  transition: opacity 0.6s ease-out, visibility 0s 0.6s;
  padding: 2rem;
  text-align: center;
  pointer-events: all;
}

#loadingScreen.fade-out {
  opacity: 0;
  visibility: hidden;
  animation: pulseFadeOut 0.6s ease-out forwards;
  pointer-events: none;
}

@keyframes pulseFadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

/* Pulse animation should NOT change overlay opacity (that reveals
   underlying content). Animate scale/text-shadow instead so the loading
   indicator pulses while fully obscuring page content. */
@keyframes pulse {
  0%, 100% { transform: scale(1); text-shadow: 0 0 20px rgba(243,236,64,0.8), 0 0 40px rgba(243,236,64,0.5); }
  50% { transform: scale(1.02); text-shadow: 0 0 28px rgba(243,236,64,0.85), 0 0 60px rgba(243,236,64,0.6); }
}

@media (max-width: 500px) {
  h1 {
    font-size: 2.5rem;
    line-height: 1.2;
    padding: 0 1rem;
  }
  
  .grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(75px, 1fr));
  gap: 1rem;
}

@media (min-width: 400px) {
  .grid {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}

@media (min-width: 700px) {
  .grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }
}
  .card {
      background: #152a5a;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      padding: 1rem;
      text-align: center;
      color: #d1d9ff;
      width: 80%;
    }

  .thumbnail-img {
    border-radius: 0.75rem;
  }

  .meta h2 {
     max-height: 8em;
    overflow-y: auto;
      margin: 0.5rem 0 0.2rem;
      color: #f3ec40;
      margin-bottom: 0.5rem;
      margin-top: 0.5rem;
      font-size: 0.75rem;
  }

  .meta p, .meta ep {
    font-size: 0.7rem;    
     max-height: 8em;
    overflow-y: auto;
  }

  .meta ep-title {
    font-size: 1rem;
  }

  .meta ep-author {
    font-size: 0.8rem;
  }
}

@media (max-width: 600px) {
    #loadingScreen {
      font-size: 2rem;
      padding: 0rem;
      text-align: center;
    }
  }
  
  </style>
</head>
<body>
  <div class="home-btn-wrapper">
    <a href="../index.html" class="home-btn">Home</a>
  </div>
<div id="loadingScreen"><strong>
  LOADING EPISODES...</strong>
</div>
<div id="mainContent">
  <h1 id="mainHeader">GAME NIGHT: ALL SEASONS</h1>
  <div class="controls">
    <select id="seasonSelect"></select>
    <select id="formatFilter">
      <option value="All">All Formats</option>
    </select>
    <label class="checkbox">
      <input type="checkbox" id="hasGuests">Guest Appearance
    </label>
    <label class="checkbox">
      <input type="checkbox" id="hasFeatures"> Feature Episode
    </label>
    <button id="clearFiltersBtn">Clear Filters</button>
  </div>

  <div class="grid" id="episodeGrid"></div>
  
  <p id="noResultsMessage" class="hidden" style="text-align:center; color: firebrick; font-size: 2.5rem; margin-top: 2rem;">
  <strong>NO EPISODES FOUND</strong>
</p>
</div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>

  const seasonSources = {
  "Season 1": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=757152741&single=true&output=csv",
  "Season 2": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=2023760030&single=true&output=csv",
  "Season 3": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=301515880&single=true&output=csv",
  "Season 4": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1288561065&single=true&output=csv",
  "Season 5": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1845908747&single=true&output=csv",
  "Season 6": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=449618691&single=true&output=csv",
  "Season 7": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=662667958&single=true&output=csv",
  "Season 8": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=378990445&single=true&output=csv",
  "Season 9": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1144281968&single=true&output=csv",
  "Season 10": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=859905086&single=true&output=csv",
  "Season 11": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1617015858&single=true&output=csv",
  "Season 12": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=552496685&single=true&output=csv",
  "Season 13": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=2132100717&single=true&output=csv",
  "Season 14": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1201410527&single=true&output=csv",
  "Season 15": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1389368663&single=true&output=csv",
  "Season 16": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1645022033&single=true&output=csv",
  "Season 17": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1776757633&single=true&output=csv",
  "Season 18": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=160676996&single=true&output=csv",
  "Season 19": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1913635729&single=true&output=csv",
  "Season 20": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=233501622&single=true&output=csv",
  "Season 21": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSj7yentjlJS9OgA-nYRn8tRm7CTUaSUSaUGWIoUB--XInwzGXD5HsNuDjwfclPOyCkw8rW4MuuN5fM/pub?gid=1780699317&single=true&output=csv"
};

  const seasonData = {};
  const formatSet = new Set();
  let cards = [];

  const getYouTubeID = (url) => {
    const match = url.match(/(?:youtube\.com.*[?&]v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
    return match ? match[1] : null;
  };

  async function loadSeasonOptions() {
    const seasonSelect = document.getElementById("seasonSelect");
    seasonSelect.innerHTML = '';
    const allOption = document.createElement("option");
    allOption.value = "All Seasons";
    allOption.textContent = "All Seasons";
    seasonSelect.appendChild(allOption);

    for (const [name, url] of Object.entries(seasonSources)) {
      seasonData[name] = url;
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      seasonSelect.appendChild(opt);
    }

    seasonSelect.addEventListener("change", () => {
      document.getElementById("mainHeader").textContent = `Game Night: ${seasonSelect.value}`;
      renderSeason(seasonSelect.value);
    });

    const latestSeason = Object.keys(seasonSources).slice(-1)[0];
    renderSeason(latestSeason);
    document.getElementById("seasonSelect").value = latestSeason;
    document.getElementById("mainHeader").textContent = `Game Night: ${latestSeason}`;
  }

  function parseCSV(csv) {
    return new Promise((resolve) => {
      Papa.parse(csv, {
        header: true,
        skipEmptyLines: true,
        complete: (results) => resolve(results.data)
      });
    });
  }

  const mockSeasonData = {
    "Season 19": [
    {
      "Ordinal": "[#500]",
      "Episode": "S19E01",
      "Date": "20th September 2025",
      "Formats": "DangerZone, Cryptex, Distinction!, Bamboozle!, The Abyss, The Pyramid, Battlefront, Face/Off & Buzz Off!",
      "Guests": "",
      "Features": "Episode #500",
      "YouTube Link": "https://www.youtube.com/watch?v=COycobAPwHs&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=1",
      "Episode Title": "Unspecified Jungle",
      "Title Author": "thelupineone"
    },
    {
      "Ordinal": "[#501]",
      "Episode": "S19E02 (Pt 1)",
      "Date": "25th September 2025",
      "Formats": "Plinko: The Quiz, Risky Business & The Escape Artist",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=gP3qRlEE1i4&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=2",
      "Episode Title": "Penne And Teller",
      "Title Author": "conradillac"
    },
    {
      "Ordinal": "[#501]",
      "Episode": "S19E02 (Pt 2)",
      "Date": "25th September 2025",
      "Formats": "Plinko: The Quiz, Risky Business & The Escape Artist",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=YmwOlqYvSg4&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=3",
      "Episode Title": "Penne And Teller",
      "Title Author": "conradillac"
    },
    {
      "Ordinal": "[#502]",
      "Episode": "S19E03",
      "Date": "27th September 2025",
      "Formats": "Crossfire, Red Herrings! & Spotlight",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=tr8iW9l7UqY&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=4",
      "Episode Title": "I Am The Weird Old Guy Who Hosts The Quiz",
      "Title Author": "stimpsonsangle"
    }
  ],
  "Season 20": [
    {
      "Ordinal": "[#500]",
      "Episode": "S20E01",
      "Date": "20th September 2025",
      "Formats": "DangerZone, Cryptex, Distinction!, Bamboozle!, The Abyss, The Pyramid, Battlefront, Face/Off & Buzz Off!",
      "Guests": "",
      "Features": "Episode #500",
      "YouTube Link": "https://www.youtube.com/watch?v=COycobAPwHs&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=1",
      "Episode Title": "Unspecified Jungle",
      "Title Author": "thelupineone"
    },
    {
      "Ordinal": "[#501]",
      "Episode": "S20E02 (Pt 1)",
      "Date": "25th September 2025",
      "Formats": "Plinko: The Quiz, Risky Business & The Escape Artist",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=gP3qRlEE1i4&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=2",
      "Episode Title": "Penne And Teller",
      "Title Author": "conradillac"
    },
    {
      "Ordinal": "[#501]",
      "Episode": "S20E02 (Pt 2)",
      "Date": "25th September 2025",
      "Formats": "Plinko: The Quiz, Risky Business & The Escape Artist",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=YmwOlqYvSg4&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=3",
      "Episode Title": "Penne And Teller",
      "Title Author": "conradillac"
    },
    {
      "Ordinal": "[#502]",
      "Episode": "S20E03",
      "Date": "27th September 2025",
      "Formats": "Crossfire, Red Herrings! & Spotlight",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=tr8iW9l7UqY&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=4",
      "Episode Title": "I Am The Weird Old Guy Who Hosts The Quiz",
      "Title Author": "stimpsonsangle"
    },
    {
      "Ordinal": "[#503]",
      "Episode": "S20E04",
      "Date": "2nd October 2025",
      "Formats": "Battlefront, The Purge & Data Leak",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=24NHyv3850E&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=5",
      "Episode Title": "It Is Not Worth Getting Stabbed For Cathedral City",
      "Title Author": "lewist1"
    },
    {
      "Ordinal": "[#504]",
      "Episode": "S20E05",
      "Date": "9th October 2025",
      "Formats": "Bamboozle!, Moneybox & The Pyramid",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=eti0h4ml75M&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=6",
      "Episode Title": "A Throbber And A Spanker",
      "Title Author": "sj1307"
    },
    {
      "Ordinal": "[#505]",
      "Episode": "S20E06",
      "Date": "11th October 2025",
      "Formats": "Crossfire, Cryptex & Bidding War",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=Z06-E6W1tQc&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=7",
      "Episode Title": "Lock Up Your Children",
      "Title Author": "abme208"
    },
    {
      "Ordinal": "[#506]",
      "Episode": "S20E07",
      "Date": "16th October 2025",
      "Formats": "Plinko: The Quiz, Distinction! & Risky Business",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=wM1jeXBxLbQ&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=8",
      "Episode Title": "You Technically Can, And Also Don't",
      "Title Author": "ardenfetz"
    },
    {
      "Ordinal": "[#507]",
      "Episode": "S20E08",
      "Date": "18th October 2025",
      "Formats": "Battlefront, The Escape Artist & The Purge",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=XUT-Kj-URO4&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=9",
      "Episode Title": "He's Dead And Probably Not Watching",
      "Title Author": "danger_dimples"
    },
    {
      "Ordinal": "[#508]",
      "Episode": "S20E09",
      "Date": "23rd October 2025",
      "Formats": "Crossfire, DangerZone & The Abyss",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=lJl5IfEi9Fs&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=10",
      "Episode Title": "Graham Perineum To His Friends",
      "Title Author": "oni91_573"
    },
    {
      "Ordinal": "[#509]",
      "Episode": "S20E10",
      "Date": "25th October 2025",
      "Formats": "Bamboozle!, Data Leak & Google That!",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=85PwAYNyNps&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=11",
      "Episode Title": "I Would Like To Thank Type 1 Diabetes",
      "Title Author": "abme208"
    },
    {
      "Ordinal": "[#510]",
      "Episode": "S20E11",
      "Date": "30th October 2025",
      "Formats": "Battlefront, Red Herrings! & Bidding War",
      "Guests": "",
      "Features": "Halloween Special",
      "YouTube Link": "https://www.youtube.com/watch?v=27ZyIqwtE60&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=12",
      "Episode Title": "Dracula And Fish And Chips",
      "Title Author": "abme208"
    },
    {
      "Ordinal": "[#511]",
      "Episode": "S20E12",
      "Date": "1st November 2025",
      "Formats": "Plinko: The Quiz, Moneybox & Distinction!",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=WNnLqzzojHU&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=13",
      "Episode Title": "Sport Is A Bit Like Quiz, But More Physical",
      "Title Author": "lewist1"
    },
    {
      "Ordinal": "[#512]",
      "Episode": "S20E13",
      "Date": "8th November 2025",
      "Formats": "Crossfire, The Abyss & The Pyramid",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=30hs0QVhSRU&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=14",
      "Episode Title": "His Mother And His Wife Were Different People",
      "Title Author": "stimpsonsangle"
    },
    {
      "Ordinal": "[#513]",
      "Episode": "S20E14",
      "Date": "20th November 2025",
      "Formats": "Plinko: The Quiz, Cryptex, DangerZone & DEFCON",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=eZXdpVMivYU&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=15",
      "Episode Title": "Oh Cool! Nuclear War!",
      "Title Author": "oni91_573"
    },
    {
      "Ordinal": "[#514]",
      "Episode": "S20E15",
      "Date": "22nd November 2025",
      "Formats": "Bamboozle!, Red Herrings!, The Purge & DEFCON",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=1levX8I_dx0&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=16",
      "Episode Title": "Sir Francis BLT",
      "Title Author": "jr_plays_games"
    },
    {
      "Ordinal": "[#515]",
      "Episode": "S20E16",
      "Date": "27th November 2025",
      "Formats": "Data Leak, The Escape Artist & DEFCON",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=DpT_DQRa7rM&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=17",
      "Episode Title": "It Is Similar In The Sense That It Is An Empire",
      "Title Author": "lewist1"
    },
    {
      "Ordinal": "[#516]",
      "Episode": "S20E17",
      "Date": "29th November 2025",
      "Formats": "Plinko: The Quiz, Distinction! & Moneybox",
      "Guests": "",
      "Features": "",
      "YouTube Link": "https://www.youtube.com/watch?v=GysFUiQr9bs&list=PLh2VwY6Qu-PKvxYNw23pWQizKJqE84J_v&index=18",
      "Episode Title": "Fantastic To Have You Here; Now Leave",
      "Title Author": "keglercoach"
    },
    {
      "Ordinal": "[#517]",
      "Episode": "S20E18",
      "Date": "4th December 2025",
      "Formats": "Bamboozle!, TBC & Google That!",
      "Guests": "",
      "Features": "Quizmas Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    },
    {
      "Ordinal": "[#518]",
      "Episode": "S20E19",
      "Date": "6th December 2025",
      "Formats": "Crossfire, TBC & Cryptex",
      "Guests": "",
      "Features": "Quizmas Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    },
    {
      "Ordinal": "[#519]",
      "Episode": "S20E20",
      "Date": "11th December 2025",
      "Formats": "Plinko: The Quiz, TBC & Data Leak",
      "Guests": "",
      "Features": "Quizmas Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    },
    {
      "Ordinal": "[#520]",
      "Episode": "S20E21",
      "Date": "13th December 2025",
      "Formats": "Battlefront, TBC & The Escape Artist",
      "Guests": "",
      "Features": "Quizmas Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    },
    {
      "Ordinal": "[#521]",
      "Episode": "S20E22",
      "Date": "18th December 2025",
      "Formats": "Crossfire & TBC",
      "Guests": "",
      "Features": "Quizmas Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    },
    {
      "Ordinal": "[#522]",
      "Episode": "S20E23",
      "Date": "20th December 2025",
      "Formats": "Plinko: The Quiz, TBC & Google That!",
      "Guests": "",
      "Features": "Quizmas Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    },
    {
      "Ordinal": "[#523]",
      "Episode": "S20E24",
      "Date": "25th December 2025",
      "Formats": "TBC",
      "Guests": "",
      "Features": "Christmas Day Special",
      "YouTube Link": "https://www.youtube.com/watch?v=f1srUafNMAk",
      "Episode Title": ""
    }
  ]
};

async function renderSeason(seasonName) {
  const loadingScreen = document.getElementById("loadingScreen");
  const mainContent = document.getElementById("mainContent");
  
  // Hide content immediately
  mainContent.style.opacity = "0";
  mainContent.style.visibility = "hidden";
  
  loadingScreen.classList.remove("fade-out");
  loadingScreen.style.visibility = "visible";
  loadingScreen.style.opacity = "1";
  
  const startTime = Date.now();
  
  formatSet.clear();
  cards = [];
  document.getElementById("episodeGrid").innerHTML = "";

  try {
    let allRows = [];
    
    // Use mock data when running locally (file:// protocol), real data on server
    const useMockData = window.location.protocol === "file:";
    
    if (useMockData && seasonName in mockSeasonData) {
      allRows = mockSeasonData[seasonName];
    } else if (seasonName === "All Seasons") {
      const csvPromises = Object.values(seasonSources).map(url =>
        fetch(url).then(res => res.text()).catch(err => {
          console.warn(`Fetch failed: ${err}`);
          return "";
        })
      );
      const csvContents = await Promise.all(csvPromises);
      const allRowsPromises = csvContents.map(parseCSV);
      allRows = (await Promise.all(allRowsPromises)).flat();
    } else if (useMockData && seasonName in mockSeasonData) {
      allRows = mockSeasonData[seasonName];
    } else {
      const response = await fetch(seasonSources[seasonName]);
      const csvText = await response.text();
      allRows = await parseCSV(csvText);
    }
    
    displayCards(allRows);
  } catch (error) {
    console.error("Error loading season data:", error);
  }

  // Ensure loading screen shows for at least 800ms
  const elapsedTime = Date.now() - startTime;
  const minDisplayTime = 800;
  const remainingTime = Math.max(0, minDisplayTime - elapsedTime);
  
  // Small delay before starting fade to ensure content is hidden
  setTimeout(() => {
    setTimeout(() => {
      console.log("About to fade out loading screen");
      loadingScreen.classList.add("fade-out");
      mainContent.style.visibility = "visible";
      mainContent.style.opacity = "1";
      console.log("Fade-out class added");
    }, 50);
  }, remainingTime);
}

  function displayCards(rows) {
    const container = document.getElementById("episodeGrid");
    const formatDropdown = document.getElementById("formatFilter");
    formatDropdown.innerHTML = '<option value="All">All Formats</option>';

    rows.forEach((row) => {
      const videoId = getYouTubeID(row['YouTube Link']);
      if (!videoId) return;

      const formatList = (row.Formats || '').split(/[,;&]+/).map(f => f.trim()).filter(f => f);
      formatList.forEach(f => formatSet.add(f));

      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('data-formats', formatList.join('|'));
      card.setAttribute('data-guests', row.Guests ? '1' : '0');
      card.setAttribute('data-features', row.Features ? '1' : '0');

      card.innerHTML = `
      
  <div class="thumb-wrapper">
    <img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt="YouTube Thumbnail" class="thumbnail-img" />
  </div>
    <div class="meta">
    <div class="section-episode" style="margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(243, 236, 64, 0.2);">
      <ep><strong>${row.Episode || 'Untitled'} ${row.Ordinal || 'Untitled'}</strong></ep>
      <p><strong>${row.Date || ''}</strong></p>
    </div>
    <div class="section-title" ${row['Episode Title'] ? 'style="margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid rgba(243, 236, 64, 0.2);"' : ''}>
      ${row['Episode Title'] ? `<ep-title><strong><i>"${row['Episode Title']}"</i></strong></ep-title>${row['Title Author'] ? `<ep-author><i>by ${row['Title Author']}</i></ep-author>` : ''}` : ''}
    </div>
    <div class="section-formats" ${(row.Guests || row.Features) ? 'style="margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(243, 236, 64, 0.2);"' : ''}>
      <h2>${formatMultiline(row.Formats || 'N/A')}</h2>
    </div>
    <div class="section-details">
      ${row.Guests ? `<p><i>Guests:</i> ${row.Guests}</p>` : ''}
      ${row.Features ? `<p><i>Feature:</i> ${row.Features}</p>` : ''}
    </div>
  </div>
`;
      card.addEventListener('click', () => {
        window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
      });
      cards.push(card);
      container.appendChild(card);
    });

    Array.from(formatSet).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' }))
      .forEach(format => {
        const opt = document.createElement('option');
        opt.value = format;
        opt.textContent = format;
        formatDropdown.appendChild(opt);
      });

    applyFilters();
  }
  
  function formatMultiline(formatString) {
  return formatString
    .split(/[,&]+/)                 // Split on commas or ampersands
    .map(s => s.trim())            // Trim whitespace
    .filter(Boolean)               // Remove empty strings
    .join('<br>');                 // Join with line breaks
}

 function applyFilters() {
  const selectedFormat = document.getElementById("formatFilter").value;
  const requireGuests = document.getElementById("hasGuests").checked;
  const requireFeatures = document.getElementById("hasFeatures").checked;

  let visibleCount = 0;
  cards.forEach(card => {
    const formats = card.getAttribute('data-formats').split('|');
    const hasGuest = card.getAttribute('data-guests') === '1';
    const hasFeature = card.getAttribute('data-features') === '1';
    const matchesFormat = selectedFormat === "All" || formats.includes(selectedFormat);
    const matchesGuest = !requireGuests || hasGuest;
    const matchesFeature = !requireFeatures || hasFeature;

    const isVisible = matchesFormat && matchesGuest && matchesFeature;
    card.classList.toggle('hidden', !isVisible);
    if (isVisible) visibleCount++;
  });

  document.getElementById("noResultsMessage").classList.toggle("hidden", visibleCount > 0);
}

  document.getElementById("clearFiltersBtn").addEventListener("click", () => {
  document.getElementById("formatFilter").value = "All";
  document.getElementById("hasGuests").checked = false;
  document.getElementById("hasFeatures").checked = false;
  applyFilters();
});

document.getElementById("formatFilter").addEventListener("change", applyFilters);
document.getElementById("hasGuests").addEventListener("change", applyFilters);
document.getElementById("hasFeatures").addEventListener("change", applyFilters);
  loadSeasonOptions();

  </script>
</body>
</html>
